
\chapter{Cast Operations in the Wild}
\label{cha:casts}

Cast operations provide a mechanism to escape the constraints of the static type system.
A cast operation can fail at compile-time if the cast operand and the target type are incompatible,
\eg, in the expression \code{(String) new Integer(1)} a value of type \code{Integer} can \emph{never} be converted to \code{String}.
Whenever a cast operation fails at run-time, it throws a \code{ClassCastException}.
This exception is unchecked, \ie,
it is not enforced by the compiler to either handle it, or
specify the exception in the \code{throws}%
\footnote{\url{https://docs.oracle.com/javase/specs/jls/se8/html/jls-8.html\#jls-8.4.6}}
declaration of a method.

\emph{But do they pose a problem for developers?}
Several studies~\citep{kechagiaUndocumentedUncheckedExceptions2014,coelhoUnveilingExceptionHandling2015,zhitnitskyTop10Exception2016}
suggest that in \java{},
%
\done{Nate: Expand on this}
%
the \code{ClassCastException} is in the top 10 of exceptions being thrown when analysing stack traces.
These studies have analyzed the exceptions thrown in stack traces.
The exceptions come from third-party libraries \api{}s and the Android \api{},
indicating a misuse of such \api{}s.
The \code{ClassCastException} is in the top 10 of exceptions thrown,
thus it represents a problem for developers.

To illustrate the sort of problems developers have when applying casting conversions,
%
\done{Nate: Why GitHub?}
%
we performed a simple search for commits and issues including the term \code{ClassCastException} within projects marked as using the \java{} language on \github{}.
We have used \github{} since is the largest host of source code in the world~\citep{gousiosLeanGHTorrentGitHub2014}.
The searches returned about 171K commits%
\footnote{\url{https://github.com/search?l=Java&q=ClassCastException&type=Commits}}
and 73K issues%
\footnote{\url{https://github.com/search?l=Java&q=ClassCastException&type=Issues}}
%
\todo{Nate: Unclear}
\todo{Nate: Need short background section at beginning. What is a cast? upcast, downcast, instanceof? How compiled? checkcast.}
%
results respectively at the time of this writing.
At first glance, these results indicate that \code{ClassCastException} indeed represents a source for problems to developers.

\input{chapters/casts/sec-casts-issues}
\input{chapters/casts/sec-casts-rq}
\input{chapters/casts/sec-casts-stats}
\input{chapters/casts/sec-casts-methodology}
\input{chapters/casts/sec-casts-patterns}
\input{chapters/casts/sec-casts-conclusions}
