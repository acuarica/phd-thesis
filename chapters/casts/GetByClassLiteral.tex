\begin{pattern}{GetByClassLiteral}
A cast is using an application-specific guard,
but the guard depends on a class literal.

\instances{}
The following example%
\footnote{\url{http://bit.ly/elastic_elasticsearch_2SSgsFV}}
shows an instance of the \thisp{} pattern.
A cast is performed to the \code{field} variable (line 22),
based whether the runtime class of the variable is actually \code{Short.class}.

%https://lgtm.com/projects/g/elastic/elasticsearch/snapshot/dist-1916470085-1524814812150/files/server/src/main/java/org/elasticsearch/common/lucene/Lucene.java?sort=name&dir=ASC&mode=heatmap#L478
\begin{minted}[highlightlines=22]{java}
Class type = field.getClass();
if (type == String.class) {
    out.writeByte((byte) 1);
    out.writeString((String) field);
} else if (type == Integer.class) {
    out.writeByte((byte) 2);
    out.writeInt((Integer) field);
} else if (type == Long.class) {
    out.writeByte((byte) 3);
    out.writeLong((Long) field);
} else if (type == Float.class) {
    out.writeByte((byte) 4);
    out.writeFloat((Float) field);
} else if (type == Double.class) {
    out.writeByte((byte) 5);
    out.writeDouble((Double) field);
} else if (type == Byte.class) {
    out.writeByte((byte) 6);
    out.writeByte((Byte) field);
} else if (type == Short.class) {
    out.writeByte((byte) 7);
    out.writeShort((Short) field);
} else if (type == Boolean.class) {
    out.writeByte((byte) 8);
    out.writeBoolean((Boolean) field);
} else if (type == BytesRef.class) {
    out.writeByte((byte) 9);
    out.writeBytesRef((BytesRef) field);
} else {
    throw new IOException("Can't handle sort field value of type ["+type+"]");
}
\end{minted}

In the following listing,%
\footnote{\url{http://bit.ly/smartdevicelink_sdl_android_2EjJiaq}}
a cast is applied to the result of the \code{getObject} method (line 2).
The target type of the cast, \code{MyKey}, corresponds to the class literal argument, \code{MyKey.class}.
Essentially, \code{getObject} is using the \code{isInstance} method%
\footnote{\url{https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html\#isInstance-java.lang.Object-}}
of the class \code{java.lang.Class} to check whether an object is from a certain type.

%https://lgtm.com/projects/g/smartdevicelink/sdl_android/snapshot/dist-2037360569-1524814812150/files/sdl_android/src/main/java/com/smartdevicelink/proxy/rpc/GetVehicleDataResponse.java?sort=name&dir=ASC&mode=heatmap#L236
\begin{minted}[highlightlines=2]{java}
public MyKey getMyKey() {
    return (MyKey) getObject(MyKey.class, KEY_MY_KEY);
} 
\end{minted}

Similar to the first example, the next snippet%
\footnote{\url{http://bit.ly/OPCFoundation_UA-Java-Legacy_2Fb2xmZ}}
contains several type cases.
Each type case is guarded by an \code{equals} comparison between a class literal and the \code{clazz} parameter.
The cast is applied to the type parameter \code{T} only if the guard succeeds.

%https://lgtm.com/projects/g/OPCFoundation/UA-Java-Legacy/snapshot/dist-1804064538-1524814812150/files/src/main/java/org/opcfoundation/ua/encoding/binary/BinaryDecoder.java?sort=name&dir=ASC&mode=heatmap#L214
\begin{minted}[highlightlines=9]{java}
@Override
@SuppressWarnings("unchecked")
public <T> T get(String fieldName, Class<T> clazz) throws DecodingException {
    if (clazz.equals(Boolean.class)) {
        return (T) getBoolean(fieldName);
    }
    // [...]
    if (clazz.equals(ExtensionObject.class)) {
        return (T) getExtensionObject(fieldName);
    }
    // [...]
}
\end{minted}


\detection{}
This pattern is characterized by the use of a class literal.%
\footnote{\url{https://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html\#jls-15.8.2}}
The class literal needs to be used in a comparison such that guards the cast instance.

\discussion{}
This pattern may be used instead of \nameref{pat:PatternMatching} when the developer wants to match exactly the runtime class.
The \code{instanceof} operator%
\footnote{\url{https://docs.oracle.com/javase/specs/jls/se8/html/jls-15.html\#jls-15.20.2}}
returns \code{true} if the expression could be cast to the specified type,
whereas using a class literal comparison returns \code{true} if the expression is exactly the runtime class.

\related{}
This pattern can be seen as a particular instance of the \nameref{pat:TypeTag} pattern,
where the tag is given by the class literal.
As discussed above, it is related to \nameref{pat:PatternMatching} but this pattern uses an exact match of the runtime class.

\end{pattern}