\begin{pattern}{KnownReturnType}
There are cases when a method's return type is less specific than the
actual return type value.
This is often to hide implementation details, but may also be because the
  method overrides another method with a less-specific type
  and the return type is not changed covariantly.

This pattern is used to cast from the method's return type to
the \emph{known} actual return type.
This pattern is characterized by a method that always returns a
value of the same type, a subtype of the declared return type,
regardless of the context or the arguments to the method call.

\instances{}
\def\urlvar{http://bit.ly/apache_kylin_2SIjooO}


%https://lgtm.com/projects/g/apache/kylin/snapshot/dist-45150010-1524814812150/files/storage-hbase/src/main/java/org/apache/kylin/storage/hbase/steps/HBaseMRSteps.java?sort=name&dir=ASC&mode=heatmap#L211
\begin{minted}[highlightlines=1]{java}
final List<CubeSegment> mergingSegments = ((CubeInstance) seg.getRealization())
            .getMergingSegments((CubeSegment) seg);

public class CubeSegment implements IBuildable, ISegment, Serializable {
    // [...]
    private CubeInstance cubeInstance;
    // [...]
    public IRealization getRealization() {
        return cubeInstance;
    }
}

public class CubeInstance
            extends RootPersistentEntity implements IRealization, IBuildable {
    // [...]
}
\end{minted}


\def\urlvar{http://bit.ly/eclipse_pdt_2Ekeu9v}

%https://lgtm.com/projects/g/eclipse/pdt/snapshot/dist-19313119-1524814812150/files/plugins/org.eclipse.php.debug.core/src/org/eclipse/php/internal/debug/core/zend/communication/DebugConnection.java?sort=name&dir=ASC&mode=heatmap#L795
\begin{minted}[highlightlines=1]{java}
debugTarget = (PHPDebugTarget) createDebugTarget(this, launch, URL,
        requestPort, process, runWithDebug, stopAtFirstLine, project);

protected IDebugTarget createDebugTarget(DebugConnection thread,
        ILaunch launch, String url, int requestPort, PHPProcess process,
        boolean runWithDebug, boolean stopAtFirstLine, IProject project)
        throws CoreException {
    return new PHPDebugTarget(thread, launch, url, requestPort, process,
            runWithDebug, stopAtFirstLine, project);
}

public class PHPDebugTarget extends PHPDebugElement
        implements IPHPDebugTarget, IBreakpointManagerListener, IStepFilters {
}
\end{minted}

\def\urlvar{http://bit.ly/apache_activemq_2EnSivc}

%https://lgtm.com/projects/g/apache/activemq/snapshot/dist-11730660-1524814812150/files/activemq-client/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java?sort=name&dir=ASC&mode=heatmap#L235
\begin{minted}[highlightlines=1]{java}
throw (IllegalArgumentException)
        new IllegalArgumentException("Invalid broker URI: " + brokerURL)
        .initCause(e);
\end{minted}


TODO: Also Logger

Logger here
\def\urlvar{http://bit.ly/skylot_jadx_2HIoR9X}

%https://lgtm.com/projects/g/skylot/jadx/snapshot/dist-41240110-1524814812150/files/jadx-gui/src/main/java/jadx/gui/utils/LogCollector.java?sort=name&dir=ASC&mode=heatmap#L22
\begin{minted}[highlightlines=1]{java}
Logger rootLogger = (Logger) LoggerFactory.getLogger(Logger.ROOT_LOGGER_NAME);
\end{minted}


\discussion{}
This pattern usually indicates an abstraction violation: the caller 
needs to know the method implementation to know the correct target type.

  \nameref{pat:CovariantReturnType} can be considered a special case of this
  pattern where the return type is known to vary with the receiver type.
  Like that pattern, associated types~\cite{chakravartyAssociatedTypeSynonyms2005}
  in languages like \haskell{} or \rust{} 
  could be used to avoid the cast.

\end{pattern}



