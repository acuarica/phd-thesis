\begin{pattern}{CovariantReturnType}

The \thisp{} pattern is used to cast a call to a method that returns
an instance of a type that is covariant with the 
receiver type.
Commonly the method returns a instance of the receiver type itself.

\instances{}
A common instance of this pattern is for calls to the 
\code{clone} method of \code{java.lang.Object}, which returns an object of the same type as the
receiver, but whose static type is \code{Object}.

TODO: Add clone example 

In the following example,%
\def\urlvar{http://bit.ly/aws_amplify_aws_sdk_android_2FVWl13}
the \code{unmarshall} method overrides a superclass method with a covariant return type.
A cast is used on the call to the superclass method 
to change the type of the return value to match the more precise return type.

%https://lgtm.com/projects/g/aws-amplify/aws-sdk-android/snapshot/dist-2970378-1524814812150/files/aws-android-sdk-autoscaling/src/main/java/com/amazonaws/services/autoscaling/model/transform/ResourceContentionExceptionUnmarshaller.java?sort=name&dir=ASC&mode=heatmap#L39
\begin{minted}[highlightlines=11]{java}
public class ResourceContentionExceptionUnmarshaller extends StandardErrorUnmarshaller {
    public ResourceContentionExceptionUnmarshaller() {
        super(ResourceContentionException.class);
    }
    public AmazonServiceException unmarshall(Node node) throws Exception {
        // Bail out if this isn't the right error code that this
        // marshaller understands.
        String errorCode = parseErrorCode(node);
        if (errorCode == null || !errorCode.equals("ResourceContention"))
            return null;
        ResourceContentionException e = (ResourceContentionException) super.unmarshall(node);
        return e;
    }
}
\end{minted}

\discussion{}
  The case of returning \code{this} 
                 could be avoided if \java{} supported self types~\cite{bruceChallengingTypingIssues2003}.
  More generally, associated types~\cite{chakravartyAssociatedTypeSynonyms2005}
  can provide a statically typed solution, for instance in the second example
  above.

\end{pattern}


