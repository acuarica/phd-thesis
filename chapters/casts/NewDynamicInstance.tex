\begin{pattern}{NewDynamicInstance}
Dynamically creation of object by means of reflection.
These are the casts that can not be avoidable.

The \code{newInstance} method family declared in the
\code{Class}\footnote{\url{https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html\#newInstance--}},
\code{Array}\footnote{\url{https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Array.html\#newInstance-java.lang.Class-int-}}\(^{,}\)
\footnote{\url{https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Array.html\#newInstance-java.lang.Class-int...-}} and
\code{Constructor}\footnote{\url{https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Constructor.html\#newInstance-java.lang.Object...-}}
classes creates an object or array by means of reflection.

This pattern consists of casting the result of these methods to the appropriate target type.

\instances{}

%https://lgtm.com/projects/g/apache/hadoop/snapshot/6bedbef6c5f2d937a6cbc268300ce2a39609d06c/files/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/server/namenode/FSNamesystem.java?sort=name\&dir=ASC\&mode=heatmap\&showExcluded=false#L1039

The following example shows a cast from the \code{Class.newInstance()}
method.
% \footnote{\url{d}}

\begin{lstlisting}[style=java,caption={The \pname{} pattern using the \texttt{Class} class.}]
logger = (AuditLogger) Class.forName(className).newInstance();
\end{lstlisting}

%https://lgtm.com/projects/g/neo4j/neo4j/snapshot/27aaa67633e4d26446e38125d04fbbd27f938b75/files/community/collections/src/main/java/org/neo4j/helpers/collection/Iterables.java?sort=name\&dir=ASC\&mode=heatmap\&showExcluded=false#L403
The following example shows how to dynamically create an array.
%\footnote{\url{d}}

\begin{lstlisting}[style=java,caption={Example of the \pname{} pattern using the \texttt{Array} class.}]
return list.toArray( (T[]) Array.newInstance( componentType, list.size()));
\end{lstlisting}

%https://lgtm.com/projects/g/gradle/gradle/snapshot/209c3175e75af6ac30cb66c02eda15b0f8b6a616/files/subprojects/internal-integ-testing/src/main/groovy/org/gradle/integtests/fixtures/executer/OutputScrapingExecutionFailure.java?sort=name\&dir=ASC\&mode=heatmap\&showExcluded=false#L174

Whenever a constructor other than the default constructor is needed,
the \code{newInstance} method declared in the \code{Constructor} class
should be used to select the appropriate constructor,
as shown in the following example.
%\footnote{\url{d}}

\begin{lstlisting}[style=java,caption=Example of the \pname{} pattern using the \code{Constructor} class.]
return (Exception) Class
                       .forName(className)
                       .getConstructor(String.class)
                       .newInstance(message);
\end{lstlisting}

\detection{}
This detection query looks for casts,
where the expression being cast is a call site to methods mentioned above.

\discussion{}
The cast here is needed because of the dynamic essence of reflection.
This pattern is unguarded, that is,
the application programmer knows what is the target type being created.

\related{}
Reflection.

\end{pattern}